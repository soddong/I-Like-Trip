<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.plan.model.mapper.PlanMapper">
	<resultMap type="PlanDto" id="plan">
		<result column="plan_id" property="planId" />
		<result column="title" property="title" />
		<result column="user_id" property="makerId" />
		<result column="regist_date" property="registDate" />
		<result column="visibility" property="visibility" />
		<result column="comment" property="comment" />
	</resultMap>

	<select id="getPlan" parameterType="int" resultMap="plan">
		select
		plan_id, title, user_id, regist_date, visibility, comment
		from plan
		where
		plan_id = #{planId}
	</select>

	<select id="getPlans" parameterType="int" resultMap="plan">
		select
		plan_id, title, user_id, regist_date, visibility, comment
		from plan
		where
		visibility = #{visibility}
	</select>

	<select id="searchPlans" parameterType="planSearchDto"
		resultMap="plan">
		select plan_id, title, user_id, regist_date, visibility, comment
		from plan
		<where>
			<if test="keyword == 'maker'">
				and user_id = #{word}
			</if>
		</where>
	</select>
	
	<insert id="registPlan">
		insert into plan (user_id, comment, title)
		value (#{plan.makerId},#{plan.comment}, #{plan.title})
		<selectKey keyProperty="plan.planId" keyColumn="plan_id" resultType="int" order="AFTER">
			select last_insert_id() as plan_id;
		</selectKey>
	</insert>

</mapper>